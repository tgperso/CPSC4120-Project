<!DOCTYPE html>
<html>
<head>
    <title>DataVisualizationProject</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/d3-regression@1.3.9/dist/d3-regression.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css?family=Poppins:400,700,900');
        body {
            display: flex;
        }
        main {
            display: flex;
            flex: 1;
            justify-content: space-between;
            padding: 20px;
        }
        section {
            width: 60%; /* Adjust the width as needed */
        }
    </style>
</head>
<body>
    <!-- <header>
        <h4>A Data Driven Insight into the History of Music Popularity</h4>
        <p>Nic Mowll | Michael Harris | Thomas Personett</p>
    </header> -->

    <main>
        <section class="visualization">
            <h4>History of Music Popularity</h4>
            <div class="tooltip"></div>
            <div>
                <svg id="SongsByDecade"></svg>
            </div>
        </section>

        <section class="visualization">
            <div>
                <svg id="ArtistPopularity"></svg>
                <!-- <p><strong>Current Artist:<div id="artist-name">Artist Name will appear here when clicked.</div></strong></div></p>
                <button id="reset-button">Reset Lines</button> -->
                <script src="artistPop.js"></script>
            </div>
            <div>
                <svg id="bubble-graph"></svg>
                <script>
                    var width = 800
                    var height = 500


                    d3.csv("topArtists.csv").then(
                        function(data) {
                            var colors = ["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"]

                            var eras = [...new Set(data.map(d => d.era))];
                            
                            var colorScale = d3.scaleOrdinal()
                                .domain(eras)
                                .range(colors)

                            console.log(data)
                            console.log(data[0]['total_track_pop'])
                            top_tracks = function(d, n) {
                                data.sort(function(a, b) {
                                    return b['total_track_pop'] - a['total_track_pop'];
                                })
                                return data.slice(0, n);
                            }

                            var top_tracks_50 = top_tracks(data, 50);
                            var top_tracks_max = top_tracks_50[0]['total_track_pop']; 
                            var top_tracks_min = top_tracks_50[49]['total_track_pop'];
                            console.log(top_tracks_max);
                            console.log(top_tracks_min);

                            var radScale = d3.scaleLinear()
                                .domain([top_tracks_min, top_tracks_max])
                                .range([6,height/9]);

                            console.log(top_tracks_50);
                            var svg = d3.select("#bubble-graph")
                                .style("width", width)
                                .style("height", height)

                            var title = svg.append("g")
                                .append("text")
                                .attr("x", 22)
                                .attr("y", 30)
                                .attr("fill", "dimgray")
                                .style("font-size", "22px")
                                .style("font-family", "Poppins")
                                .style("font-weight", "bold")
                                .style("margin-bottom", "30px")
                                .text("Top 50 Tracks by All-Time Popularity")

                            const tooltip = d3.select(".tooltip")

                            var node = svg.append("g")
                                .selectAll("circle")
                                .data(top_tracks_50)
                                .enter()
                                .append("circle")
                                    .attr("cx", width / 2)
                                    .attr("cy", height / 2)
                                    .attr("fill", d => d3.color(colorScale(d.era)))
                                    .attr("r", d => radScale(d.total_track_pop))
                                    .on("mouseover", function(event, d) {
                                        const [mouseX, mouseY] = [event.pageX, event.pageY];
                                    
                                        tooltip
                                        .style("display", "block")
                                        .html(`<strong>Track:<strong> ${d.title} <br><strong>Artist:</strong> ${d.artist}<br><strong>Era:</strong> ${d.era}<br><strong>Popularity:</strong> ${d.total_track_pop}`)
                                        .style("left", mouseX + 20 + "px")
                                        .style("top", mouseY - 30 + "px");
                                        
                                        d3.select(this)
                                        .attr("r", d => radScale(d.total_track_pop)+2)
                                        .style("transition", "all 0.1s ease")
                                        .raise()
                                    })
                                    .on("mouseout", function(d) {
                                        tooltip.style("display", "none");

                                        d3.select(this)
                                            .attr("r", d => radScale(d.total_track_pop))
                                            .style("transition", "all 0.1s ease")
                                    })

                            var simulation = d3.forceSimulation(top_tracks_50)

                            simulation
                                .force("center", d3.forceCenter().x(width / 2).y(height / 2 + 20))
                                .force("charge", d3.forceManyBody().strength(5))
                                .force("collide", d3.forceCollide().strength(.1)
                                .radius(function(d){ return radScale(d.total_track_pop)+2; })
                                .iterations(1))
                                .on("tick", function(d){
                                    node
                                        .attr("cx", function(d){ return d.x; })
                                        .attr("cy", function(d){ return d.y; })
                                })

                            
                        }
                    )
                </script>
            </div>
        </section>

        <!-- <section class="visualization">
            <div>
                <svg id="distro-vis"></svg>
                <script src="distro.js"></script>
            </div>
        </section> -->
    </main>

    <!-- <footer>
        <p>Thank you to Dylan Burati for the BillBoard Hot 100 - Full History Dataset</p>
        <h3>Source: https://www.kaggle.com/datasets/dylanburati/billboard-hot-100-full-history</h3>
    </footer> -->

    <script src="SongsByDecade.js"></script>
    <!-- <script src="topArtists.js"></script> -->
    <!-- <script src="distro.js"></script> -->
</body>
</html>
